#
# KITTY CONFIGURATION
#
# Author: Daniel Nordstrom <d@mrnordstrom.com>
# Repository: https://github.com/dnordstrom/dotfiles
#
# See:
#   - Overview: https://sw.kovidgoyal.net/kitty/overview/
#   - Options: https://sw.kovidgoyal.net/kitty/conf/
#   - Actions: https://sw.kovidgoyal.net/kitty/actions/
#   - Default: https://sw.kovidgoyal.net/kitty/_downloads/433dadebd0bf504f8b008985378086ce/kitty.conf
#

#
# APPEARANCE
#

include ./catppuccin.conf

cursor_blink_interval 0
cursor_shape block

font_family InputMonoCondensed
bold_font InputMonoCondensed Bold
italic_font InputMonoCondensed Italic
bold_italic_font InputMonoCondensed BoldIta
font_size 9.0

disable_ligatures cursor

window_padding_width 8 10
window_border_width 1px

active_border_color #EBDDAA
inactive_border_color #C3BAC6

background_opacity 1.0
dynamic_background_opacity yes
dim_opacity 0.75

tab_bar_style separator
tab_bar_margin_height 6.0 0.0
tab_bar_margin_width 4.0
tab_separator " "
tab_title_template "  {title} "
active_tab_title_template "{fmt.bold}  {title} {fmt.nobold}"
tab_bar_background none
active_tab_font_style = italic
inactive_tab_font_style = italic

window_resize_step_cells 20
window_resize_step_lines 20

enabled_layouts horizontal,vertical,tall,grid

#
# BEHAVIOR
#

term xterm-kitty
linux_display_server wayland
allow_remote_control yes
listen_on unix:@mykitty

# On Wayland, touch scroll is also used for mice
wheel_scroll_multiplier 5.0
touch_scroll_multiplier 5.0
scrollback_pager_history_size 2.0 

enable_audio_bell no
mouse_hide_wait -1
focus_follows_mouse yes

url_style single
strip_trailing_spaces smart
select_by_word_characters @-./_~?&=%+#

editor nvim

# nvim scrollback pager, redit to page-down on GitHub:
# https://github.com/kovidgoyal/kitty/issues/719#issuecomment-952039731
scrollback_pager bash -c "exec nvim 63<&0 0</dev/null -c 'map <silent> q :qa!<CR>' -c 'set shell=bash scrollback=100000 termguicolors laststatus=2' -c 'autocmd TermEnter * stopinsert' -c 'autocmd TermClose * call cursor(max([0,INPUT_LINE_NUMBER-1])+CURSOR_LINE, CURSOR_COLUMN)' -c 'terminal sed </dev/fd/63 -e \"s/'$'\x1b'']8;;file:[^\]*[\]//g\" && sleep 0.01 && printf \"'$'\x1b'']2;\"'"

#
# MAPS
#

# Config

map kitty_mod+f1 launch firefox https://sw.kovidgoyal.net/kitty
map f1 launch firefox https://sw.kovidgoyal.net/kitty
map kitty_mod+f2 set_tab_title
map kitty_mod+f5 load_config_file /etc/nixos/config/kitty/kitty.conf

map f2 set_tab_title
map f5 load_config_file
map f6 debug_config

map kitty_mod+alt+u kitten unicode_input

# Mouse actions

mouse_map left click ungrabbed mouse_click_url_or_select

# Layout management

map kitty_mod+w>o next_layout
map kitty_mod+w>i last_used_layout
map kitty_mod+w>a layout_action increase_num_full_size_windows
map kitty_mod+w>x layout_action decrease_num_full_size_windows
map kitty_mod+w>] layout_action increase_num_full_size_windows
map kitty_mod+w>[ layout_action decrease_num_full_size_windows

map kitty_mod+w>kitty_mod+o layout_action next_layout
map kitty_mod+w>kitty_mod+i layout_action last_used_layout
map kitty_mod+w>kitty_mod+a layout_action increase_num_full_size_windows
map kitty_mod+w>kitty_mod+x layout_action decrease_num_full_size_windows
map kitty_mod+w>kitty_mod+] layout_action increase_num_full_size_windows
map kitty_mod+w>kitty_mod+[ layout_action decrease_num_full_size_windows

# Window management

# Vim mappings
map kitty_mod+enter new_window_with_cwd
map kitty_mod+h neighboring_window left
map kitty_mod+j neighboring_window bottom
map kitty_mod+k neighboring_window top
map kitty_mod+l neighboring_window right

# W prefix key
map kitty_mod+w>w nth_window -1
map kitty_mod+w>n new_window_with_cwd
map kitty_mod+w>N new_window_with_cwd
map kitty_mod+w>s launch --cwd=current --location=hsplit
map kitty_mod+w>v launch --cwd=current --location=vsplit

map kitty_mod+w>h neighboring_window left
map kitty_mod+w>j neighboring_window bottom
map kitty_mod+w>k neighboring_window top
map kitty_mod+w>l neighboring_window right

map kitty_mod+w>r>r start_resizing_window
map kitty_mod+w>r>h resize_window narrower 20
map kitty_mod+w>r>l resize_window wider 20
map kitty_mod+w>r>k resize_window taller 20
map kitty_mod+w>r>j resize_window shorter 20
map kitty_mod+w>plus resize_window taller 20
map kitty_mod+w>minus resize_window shorter 20
map kitty_mod+w>equal reset_window_sizes

map kitty_mod+w>c close_window

# W prefix key held

map kitty_mod+w>kitty_mod+w nth_window -1
map kitty_mod+w>kitty_mod+n new_window_with_cwd
map kitty_mod+w>kitty_mod+N new_window_with_cwd
map kitty_mod+w>kitty_mod+s launch --cwd current --location hsplit
map kitty_mod+w>kitty_mod+v launch --cwd current --location vsplit
map kitty_mod+w>kitty_mod+h neighboring_window left
map kitty_mod+w>kitty_mod+j neighboring_window bottom
map kitty_mod+w>kitty_mod+k neighboring_window top
map kitty_mod+w>kitty_mod+l neighboring_window right
map kitty_mod+w>kitty_mod+r>kitty_mod+h resize_window narrower 20
map kitty_mod+w>kitty_mod+r>kitty_mod+l resize_window wider 20
map kitty_mod+w>kitty_mod+r>kitty_mod+k resize_window taller 20
map kitty_mod+w>kitty_mod+r>kitty_mod+j resize_window shorter 20
map kitty_mod+w>kitty_mod+r>kitty_mod+r start_resizing_window
map kitty_mod+w>kitty_mod+equal reset_window_sizes
map kitty_mod+w>kitty_mod+c close_window

# Tab navigation

map kitty_mod+t>c close_tab
map kitty_mod+t>kitty_mod+c close_tab
map kitty_mod+t>n new_tab !neighbor
map kitty_mod+t>kitty_mod+n new_tab !neighbor
map kitty_mod+t>t goto_tab -1
map kitty_mod+t>kitty_mod+t goto_tab -1
map kitty_mod+t>h previous_tab
map kitty_mod+t>kitty_mod+h previous_tab
map kitty_mod+t>l next_tab
map kitty_mod+t>kitty_mod+l next_tab
map kitty_mod+t>r set_tab_title
map kitty_mod+t>kitty_mod+r set_tab_title
map kitty_mod+t>j move_tab_backward
map kitty_mod+t>kitty_mod+j move_tab_backward
map kitty_mod+t>k move_tab_forward
map kitty_mod+t>kitty_mod+k move_tab_forward
map kitty_mod+alt+t>h move_tab_backward
map kitty_mod+alt+t>kitty_mod+alt+h move_tab_backward
map kitty_mod+alt+t>l move_tab_forward
map kitty_mod+alt+t>kitty_mod+alt+l move_tab_forward

# Seamless nvim <-> kitty navigation

map ctrl+h kitten pass_keys.py neighboring_window left ctrl+h
map ctrl+j kitten pass_keys.py neighboring_window bottom ctrl+j
map ctrl+k kitten pass_keys.py neighboring_window top ctrl+k
map ctrl+l kitten pass_keys.py neighboring_window right ctrl+l

# Scrolling

map kitty_mod+u scroll_page_up
map kitty_mod+d scroll_page_down

map kitty_mod+up scroll_page_up
map kitty_mod+down scroll_page_down

#
# Remapping overlapping defaults from kitty_mod+key to kitty_mod+alt+key
#

map kitty_mod+alt+h show_scrollback

#
# Vim modifier maps
#

map ctrl+tab send_text all \x1b[9;5u
map ctrl+shift+tab send_text all \x1b[9;6u

map ctrl+enter send_text all \x1b[13;5u
map shift+enter send_text all \x1b[13;2u
map ctrl+shift+enter send_text all \x1b[13;6u

map ctrl+backspace send_text all \x1b[127;5u
map shift+backspace send_text all \x1b[127;2u
map ctrl+shift+backspace send_text all \x1b[127;6u

# vim:ft=kitty
